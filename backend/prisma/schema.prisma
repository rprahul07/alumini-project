generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          Int      @id @default(autoincrement())
  fullName    String   @map("full_name") @db.VarChar(100)
  email       String   @unique @db.VarChar(100)
  password    String   @db.VarChar(255)
  phoneNumber String?  @map("phone_number") @db.VarChar(20)
  department  String?  @db.VarChar(100)
  role        Role
  photoUrl    String?  @map("photo_url") @db.VarChar(500)
  bio         String?  @db.Text
  linkedinUrl String?  @map("linkedin_url") @db.VarChar(500)
 
  createdAt   DateTime @default(now()) @map("created_at")
  admin       Admin?
  alumni      Alumni?
  faculty     Faculty?
  student     Student?

  @@index([email])
  @@map("users")
}

model Student {
  id              Int    @id @default(autoincrement())
  currentSemester Int    @map("current_semester") @db.Integer
  rollNumber      String @unique @map("roll_number") @db.VarChar(50)
  graduationYear  Int?   @map("graduation_year")
  userId          Int    @unique @map("user_id")
  user            User   @relation(fields: [userId], references: [id])

  @@map("students")
}

model Alumni {
  id              Int                   @id @default(autoincrement())
  graduationYear  Int                   @map("graduation_year")
  course          String?               @db.VarChar(100)
  currentJobTitle String                @map("current_job_title") @db.VarChar(100)
  companyName     String                @map("company_name") @db.VarChar(100)
  userId          Int                   @unique @map("user_id")
  user            User                  @relation(fields: [userId], references: [id])
  workExperience  AlumniWorkExperience[]

  @@map("alumni")
}

model AlumniWorkExperience {
  id          Int    @id @default(autoincrement())
  companyName String @map("company_name") @db.VarChar(100)
  role        String @db.VarChar(100)
  alumniId    Int    @map("alumni_id")
  alumni      Alumni @relation(fields: [alumniId], references: [id], onDelete: Cascade)

  @@index([alumniId])
  @@map("alumni_work_experience")
}

model Faculty {
  id          Int    @id @default(autoincrement())
  designation String @db.VarChar(100)
  userId      Int    @unique @map("user_id")
  user        User   @relation(fields: [userId], references: [id])

  @@map("faculty")
}

model Admin {
  id     Int  @id @default(autoincrement())
  userId Int  @unique @map("user_id")
  user   User @relation(fields: [userId], references: [id])

  @@map("admins")
}

model ActivityLog {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  action    String   @db.VarChar(100)
  details   Json?
  createdAt DateTime @default(now()) @map("created_at")
  userType  Role     @map("user_type")

  @@index([userId])
  @@map("activity_logs")
}

model PasswordChangeLog {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  changedAt DateTime @default(now()) @map("changed_at")
  userType  Role     @map("user_type")

  @@index([userId])
  @@map("password_change_logs")
}

model EmailChangeLog {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  oldEmail  String   @map("old_email") @db.VarChar(100)
  newEmail  String   @map("new_email") @db.VarChar(100)
  changedAt DateTime @default(now()) @map("changed_at")
  userType  Role     @map("user_type")

  @@index([userId])
  @@map("email_change_logs")
}

enum Role {
  student
  alumni
  faculty
  admin
}